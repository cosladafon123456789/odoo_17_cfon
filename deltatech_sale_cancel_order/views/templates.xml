<?xml version="1.0" encoding="utf-8" ?>
<odoo>

        <template id="sale_order_portal_content" inherit_id="sale.sale_order_portal_content" priority="900">
            <div id="sale_info" position="inside">
                <t t-if="sale_order.cancel_requested and sale_order.state != 'cancel'">
                    <span class="badge badge-pill bg-danger">
                        <span>Cancel requested</span>
                    </span>
                </t>
            </div>
        </template>

        <template id="sale_order_portal_template_cancel" inherit_id="sale.sale_order_portal_template" priority="100">

            <xpath expr="//div[@id='sale_order_communication']" position="before">
                <t t-if="not sale_order.cancel_requested and sale_order.state != 'cancel'">
                    <div role="dialog" class="modal fade" id="modaldecline_or_cancel">
                        <div class="modal-dialog">
                            <form
                            id="decline"
                            method="POST"
                            t-attf-action="/my/orders/#{sale_order.id}/decline?access_token=#{sale_order.access_token}&amp;cancel_requested=1"
                            class="modal-content"
                        >
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                <header class="modal-header">
                                    <h4 t-if='sale_order.state != "sale"' class="modal-title">Reject This Quotation</h4>
                                    <h4 t-if='sale_order.state == "sale"' class="modal-title">Reject This Order</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">Ã—
                                    </button>
                                </header>
                                <main class="modal-body">
                                    <p t-if='sale_order.state != "sale"'>
                                        Tell us why you are refusing this quotation, this will help us improve our
                                        services.
                                    </p>
                                    <p t-if='sale_order.state == "sale"'>
                                        Tell us why you are refusing this order, this will help us improve our services.
                                    </p>
                                    <textarea
                                    rows="4"
                                    name="decline_message"
                                    required=""
                                    placeholder="Your feedback..."
                                    class="form-control"
                                />
                                </main>
                                <footer class="modal-footer">
                                    <button type="submit" t-att-id="sale_order.id" class="btn btn-danger">
                                        <i class="fa fa-times" />
                                        Request Cancellation
                                    </button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                </footer>
                            </form>
                        </div>
                    </div>
                    <div class="row justify-content-center text-center d-print-none pt-1 pb-4">
                        <div class="col-sm-auto mt8">
                            <a
                            role="button"
                            class="btn btn-danger"
                            data-bs-toggle="modal"
                            data-bs-target="#modaldecline_or_cancel"
                            href="#"
                        >
                                <i class="fa fa-times" />
                                Request Cancellation
                            </a>
                        </div>
                    </div>
                </t>
            </xpath>
        </template>

        <template id="portal_my_quotations_cancel" inherit_id="sale.portal_my_quotations">
            <xpath expr="//t[@t-foreach='quotations']/tr/td[last()-1]" position="inside">
                <t t-if="quotation.cancel_requested and quotation.state != 'cancel'">
                    <span class="badge badge-pill bg-danger">Cancel requested</span>
                </t>
            </xpath>
        </template>

        <template id="portal_my_orders_cancel" inherit_id="sale.portal_my_orders">
            <xpath expr="//t[@t-foreach='orders']/tr/td[last()-1]/span" position="before">
                <t t-if="order.cancel_requested and order.state != 'cancel'">
                    <span class="badge badge-pill bg-danger">
                        <span>Cancel requested</span>
                    </span>
                </t>
            </xpath>
        </template>

</odoo>
