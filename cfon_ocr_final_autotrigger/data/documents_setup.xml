<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Carpeta en Documentos -->
  <record id="folder_vendor_bills_ocr_pro" model="documents.folder">
    <field name="name">Facturas Proveedor (OCR Gratis)</field>
  </record>

  <!-- Acción servidor: código OCR -->
  <record id="action_ocr_process_document_pro" model="ir.actions.server">
    <field name="name">Procesar por OCR (Gratis Pro)</field>
    <field name="model_id" ref="documents.model_documents_document"/>
    <field name="state">code</field>
    <field name="code">
for doc in records:
    env['invoice.ocr.engine'].process_document(doc)
    </field>
  </record>

  <!-- Automatización: disparar al CREAR/EDITAR si está en la carpeta y no tiene enlace -->
  <record id="auto_trigger_ocr_on_create" model="base.automation">
    <field name="name">CFON OCR - Auto al subir/mover</field>
    <field name="model_id" ref="documents.model_documents_document"/>
    <field name="trigger">on_create_or_write</field>
    <field name="active">True</field>
    <field name="filter_domain">[
      ('folder_id','=', ref('cfon_ocr_final_autotrigger.folder_vendor_bills_ocr_pro')),
      ('res_model','=', False),
      ('mimetype','in',('application/pdf','image/jpeg','image/png'))
    ]</field>
    <field name="state">code</field>
    <field name="code">
# Ejecutar la misma lógica que la acción servidor
for doc in records:
    env['invoice.ocr.engine'].process_document(doc)
    </field>
  </record>
</odoo>
