<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Acción preconfigurada para informes de motivos de devolución -->
    <record id="action_cf_devolucion_report" model="ir.actions.act_window">
        <field name="name">Motivos de devolución</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">pivot,graph,tree</field>
        <field name="domain">[('motivo_devolucion','!=',False)]</field>
        <field name="context">
            {
                "search_default_groupby_motivo": 1,
                "pivot_measures": ["__count"],
            }
        </field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Registra devoluciones desde el botón "Recibido" para ver aquí sus motivos y tipo de error.
            </p>
        </field>
    </record>

    <!-- Menú en Ventas > Informes > Motivos de devolución -->
    <menuitem id="menu_cf_devolucion_report_root"
              name="Motivos de devolución"
              parent="sale.menu_sale_report"
              sequence="65"
              action="action_cf_devolucion_report"/>

    <!-- Añadir búsqueda personalizada con filtros y agrupaciones -->
    <record id="view_sale_order_search_cf_devolucion" model="ir.ui.view">
        <field name="name">sale.order.search.cf.devolucion</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <filter name="has_motivo" string="Con motivo de devolución" domain="[('motivo_devolucion','!=',False)]"/>
                <group expand="0" string="Agrupar por">
                    <filter name="groupby_motivo" string="Motivo devolución" context="{'group_by': 'motivo_devolucion'}"/>
                    <filter name="groupby_tipo_error" string="Tipo de error" context="{'group_by': 'tipo_error_devolucion'}"/>
                </group>
            </xpath>
        </field>
    </record>
</odoo>